# Runbook とは

特定の事象・業務に対して、
**「観測 → 判断 → 実行 → 記録」**までを構造化した運用標準書

単なる手順メモではなく
**目的は 「誰が実行しても同じ初動・同じ質に近づく」こと**

## 良いRunbookの条件

	1.	初動5分で使える
	2.	コピペ可能なコマンド付き
	3.	判断分岐が明確
	4.	記録欄がある
	5.	更新履歴がある


# Runbook成熟度レベルモデル

| レベル | 名称 | 特徴 | 主な構成要素 | リスク | 次の段階へ進む鍵 |
|--------|------|------|--------------|--------|----------------|
| Lv1 | 手順記録型 | 作業手順のみ記載 | 実行コマンド | 判断が属人化 | トリガー明確化 |
| Lv2 | 条件分岐型 | IF分岐あり | 判断基準 | ログ取得が曖昧 | 観測設計追加 |
| Lv3 | 観測統合型 | 取得ログが標準化 | コマンド＋ログ箇所 | 原因分類が曖昧 | 原因体系化 |
| Lv4 | 原因分類型 | 特別原因/共通原因区別 | 記録欄＋再発防止枠 | 予防設計未連動 | 監視と接続 |
| Lv5 | 予防連動型 | 監視閾値と連動 | Runbook ⇄ Alert連携 | 更新停滞 | 改善サイクル自動化 |
| Lv6 | 改善循環型 | 事後レビューが必ず反映 | MTTR指標・変更履歴 | なし（理想形） | 組織標準化 |

---

## 各レベルの状態イメージ

### Lv1：メモ
・「こうやるらしい」レベル  
・人が変わると品質が変わる  

### Lv2：判断補助
・最低限の分岐あり  
・初動は揃うが、深掘りで差が出る  

### Lv3：観測標準化
・誰がやっても同じログを取る  
・調査の再現性が上がる  

### Lv4：構造化
・原因が分類される  
・再発防止の視点が入る  

### Lv5：監視統合
・Alert → Runbook直リンク  
・Toil削減  

### Lv6：編集型成長状態
・Runbookが増えるほど判断が減る  
・MTTRが年単位で改善  

---

## 現在地（推定）

・観測設計やOOM/Kernel Panic体系図を作ろうとしている  
→ Lv3〜Lv4移行期  

---

## 成熟度を測る指標例

- 初動ログ取得のばらつき率
- 同一障害の再発率
- MTTR中央値
- Runbook更新頻度
- 「判断が必要だった回数」自己記録

---


# Runbookテンプレ（標準版）

```
# Runbook: [タイトル]

## 1. 目的
このRunbookの対象範囲とゴール

## 2. 適用条件（トリガー）
・どの状態で開始するか
・アラート条件
・問い合わせ内容例

## 3. 影響確認
□ 影響範囲確認
□ 依存サービス確認
□ 優先度判定

## 4. 初動対応（5〜15分以内）
### 4.1 状態確認コマンド
```

⸻

# コマンド例

```
### 4.2 取得すべきログ
・ログパス
・期間
・キーワード

## 5. 切り分けフロー
IF Aなら → 6へ  
IF Bなら → 7へ  

## 6. 暫定対応
手順

## 7. 恒久対応候補
原因仮説
対処案

## 8. エスカレーション基準
・◯分以内に改善しない
・◯◯が確認された

## 9. 記録
・発生時刻
・影響範囲
・原因分類（特別原因/共通原因）
・再発防止メモ
```

⸻

# 実例（CI基盤 OOM初動Runbook）

```
# Runbook: CI基盤 OOM初動対応

## 1. 目的
OOM発生時の初動統一と影響最小化

## 2. トリガー
・PodがOOMKilled
・Node MemoryPressure
・Java OutOfMemoryError

## 3. 影響確認
□ 失敗ビルド数
□ 影響プロジェクト数
□ 他Podへの波及

## 4. 初動確認

### Node確認
kubectl describe node <node>

### Pod確認
kubectl describe pod <pod>

### イベント確認
kubectl get events --sort-by=.lastTimestamp

## 5. 分岐

### Case A: Pod OOMKilled
→ limits超過確認
→ 直近デプロイ差分確認

### Case B: Node MemoryPressure
→ 他Podメモリ使用量確認
→ Eviction履歴確認

## 6. 暫定対応
・Pod再起動
・limit引き上げ（暫定）

## 7. 恒久対応
・Heap分析
・リソース設計見直し
・監視閾値調整

## 8. 記録
原因: 特別/共通
再発防止策:
```